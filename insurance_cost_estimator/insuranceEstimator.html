<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office"xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">
	<head>
	    <script type="text/javascript" src="/Style%20Library/V7/js/vendor/mdb/jquery-3.3.1.min.js"></script>
	    <style type="text/css">
		h4.tier{
			font-weight:bold!important;
			font-size:1.25rem!important
		}
		h5.cost{
			font-weight:normal!important
		}
		h5.active, h4.active{
			color:white!important;
		}
		.active-card{
			background:#0277BD
		}
		.card{
			cursor:pointer;
			border-radius:0px!important
		}
		.columnTitle, .rowTitle{
			font-weight:500;
			font-size:1.05rem;
		}
		.columnTitle{
			border-top:none!important;
			border-bottom:none;
		}
		.rowTitle{
			vertical-align:baseline!important;
			background:#1C2A48;
			color:white;
			border-top:thin #eaeaea solid!important;			
			border-right:thin #eaeaea solid;
			border-left:thin #eaeaea solid;
			border-top-right-radius:6px!important;
			border-top-left-radius:6px!important;
		}
		.subtotal, .total, .normalCell{
			border-right:thin #eaeaea solid;
			border-left:thin #eaeaea solid;
			border-bottom:none!important;
			border-top:none!important;
			width:140px;
		}
		.subtotal, .total{
			font-weight:500;
		}
		.subtotal{
			font-size:1.1rem;
			background:#81D4FA;
		}
		.total{
			font-size:1.15rem;
			background:#0277BD;
			color:white;
			border-bottom-right-radius:6px;
			border-bottom-left-radius:6px;
		}
		.normalCell{
			font-size:1rem;
			font-weight:300;
		}
		.nostyle{
			border:none!important
		}
		table{
			border-collapse:separate!important;
		}
		@media only screen and (max-width: 992px) {

		}
		input[type="checkbox"]{
			position:static!important;
			opacity:1!important;
			pointer-events:auto!important;
		}
	    </style>
	</head>
	<body>
	<!-- Section: Pricing v.4 -->
	<div class="container" id="webpartToMove">
<section class="text-center" id="intoView">

  <!-- Grid row -->
  <div class="row mb-5 px-4">

<!-- Grid column -->
    <div class="col-lg-3 col-md-6 my-lg-0 my-2 mx-0 px-0">

      <!-- Card -->
      <div class="card" id="Employee">
      

        <!-- Content -->
        <div class="card-body active-card">

          <!-- Offer -->
          
          <div class="d-flex justify-content-center icon text-white">
            <div class="d-flex justify-content-center align-items-center">
              <i class="fas fa-user fa-2x"></i>
            </div>
          </div>
          <h4 class=" tier active">Employee</h4>
          

          <!--Price -->
          <h5 class="cost active">from $10.39<sub>/bi-weekly</sub></h5>
          <!--<a class="btn btn-indigo btn-rounded">Buy now</a>-->

        </div>
        <!-- Content -->

      </div>
      <!-- Card -->

    </div>
    <!-- Grid column -->

<!-- Grid column -->
    <div class="col-lg-3 col-md-6 my-lg-0 my-2 mx-0 px-0">

      <!-- Card -->
      <div class="card z-depth-0 border" id="EmployeeandSpouse">

        <!-- Content -->
        <div class="card-body">

          <!-- Offer -->
          
          <div class="d-flex justify-content-center icon">
            <div class="d-flex justify-content-center align-items-center">
              <i class="fas fa-user fa-2x"></i><i class="fas fa-user fa-2x"></i>
            </div>
          </div>
          <h4 class="tier">Employee & Spouse</h4>
          
          <!--Price -->
          <h5 class="cost">from $26.59<sub>/bi-weekly</sub></h5>
          <!--<a class="btn btn-indigo btn-rounded">Buy now</a>-->

        </div>
        <!-- Content -->

      </div>
      <!-- Card -->

    </div>
    <!-- Grid column -->

<!-- Grid column -->
    <div class="col-lg-3 col-md-6 my-lg-0 my-2 mx-0 px-0">

      <!-- Card -->
      <div class="card z-depth-0 border" id="EmployeeandChildren">

        <!-- Content -->
        <div class="card-body">

          <!-- Offer -->
          
          <div class="d-flex justify-content-center icon">
            <div class="d-flex justify-content-center align-items-center">
              <i class="fas fa-users fa-2x"></i>
            </div>
          </div>
          <h4 class="tier">Employee & Child(ren)</h4>

          <!--Price -->
          <h5 class="cost">from $19.91<sub>/bi-weekly</sub></h5>
          <!--<a class="btn btn-indigo btn-rounded">Buy now</a>-->

        </div>
        <!-- Content -->

      </div>
      <!-- Card -->

    </div>
    <!-- Grid column -->

    <!-- Grid column -->
    <div class="col-lg-3 col-md-6 my-lg-0 my-2 mx-0 px-0">

      <!-- Card -->
      <div class="card z-depth-0 border" id="EmployeeandFamily">

        <!-- Content -->
        <div class="card-body">

          <!-- Offer -->
          
          <div class="d-flex justify-content-center icon">
            <div class="d-flex justify-content-center align-items-center">
              <i class="fas fa-users fa-2x"></i>
            </div>
          </div>
          <h4 class="tier">Employee & Family</h4>

          <!--Price -->
          <h5 class="cost">from $76.94<sub>/bi-weekly</sub></h5>
          <!--<a class="btn btn-indigo btn-rounded">Buy now</a>-->

        </div>
        <!-- Content -->

      </div>
      <!-- Card -->

    </div>
    <!-- Grid column -->


  </div>
  <!-- Grid row -->

</section>
<section>
	<div class="row mt-2">
		<table class="table table-responsive">
		  <thead>
		    <tr class="plans">
		    </tr>
		  </thead>
		  <tbody id="mainTableBody">
		  </tbody>
		</table>
	</div>
</section>

<!-- Frame Modal Bottom -->
<div class="modal fade bottom " id="frameModalBottom" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true" data-backdrop="false" data-keyboard="false">

  <!-- Add class .modal-frame and then add class .modal-bottom (or other classes from list above) to set a position to the modal -->
  <div class="modal-dialog modal-frame modal-bottom" role="document">
    <div class="modal-content">
      <div class="modal-body light-blue darken-1">
        <div class="row d-flex justify-content-center align-items-center">
			<div class="col-12 d-flex justify-content-between">
			<div class="comparisons"></div>
				<div>
					<button type="button" class="btn btn-warning btn-large compare">Compare</button>
					<button type="button" class="btn btn-warning btn-large reset d-none">Reset</button>
				</div>
			</div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Frame Modal Bottom -->
</div>
<!-- Section: Pricing v.4 -->
		 	    
	    <script type="text/javascript" src="/Style%20Library/V7/js/vendor/mdb/jquery-3.3.1.min.js"></script>
	    <script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.flat%2Ces6"></script>

	    <script type="text/javascript">
		$(function () {
		  $.ajax({
		    url: "/openenrollment/_api/web/lists/GetByTitle('insuranceEstimator')/items",
		    method: 'GET',
		    headers: {
		      Accept: 'application/json; odata=verbose'
		    },
		
		    success: function (data) {
		      let thisPlanResults = data.d.results
		      let planItems = []
		      let tier = 'Employee'
				console.log(thisPlanResults)
		      function onlyUnique (value, index, self) {
		        return self.indexOf(value) === index
		      }
		      
		    	String.prototype.commafy = function () {
				    return this.replace(/(^|[^\w.])(\d{4,})/g, function($0, $1, $2) {
				        return $1 + $2.replace(/\d(?=(?:\d\d\d)+(?!\d))/g, "$&,");
				    });
				}
				
				let effectIn = function () {
					return $(".table").fadeTo(500, 1);
				};
		
				let effectOut = function () {
					return $(".table").fadeTo(500, 0);
				};

		      let setDefault = function () {
		        planItems = $.each(thisPlanResults, function (ind, planItems) {
		          return planItems
		        })
		
		      }
		      setDefault()
		      
		      let sortPlans = function(){
		      	planItems = planItems.sort(function (a, b) {
		          return a.PlanNumber - b.PlanNumber
		        })
		      }
				sortPlans()
					
		      let buildPlans = function () {
		        let allPlans = []
		        $('.plans').append('<th scope="col-2" style="border:none!important"></th>')
		        for (let i = 0; i < planItems.length; i++) {
		          var filterPlans = planItems[i]
		          allPlans.push(filterPlans.Plan)
		        };
		        // allTopics.sort();
		        let planList = allPlans.filter(onlyUnique)
		
		        for (let i = 0; i < planList.length; i++) {
		          var planName = planList[i]
		          $('.plans').append('<th scope="col" class= "p-3 text-center ' + planName.replace(/[^A-Z0-9]/ig, '') + ' rowTitle"><div style="font-size:.7rem" class="align-top compareInput d-none d-sm-none d-md-block"><input type="checkbox" value="' + planName + '"> Compare</div> <br><div class="align-middle">' + planName + '</div></th><th class="nostyle"></th>')
		        }
		      }
		      buildPlans()
		      
		      let clearTable = function () {
		        $('.plans').empty()
		        $('#mainTableBody').html('')
		        $('.compareChoice').remove()
		      }
		
		      let columnTitles = function () {
		        $('#mainTableBody').html('<tr><th scope="row" class="annualDeductible columnTitle">Annual Deductible</th></tr>' +
		          '<tr><th scope="row" class="maxOutOfPocket columnTitle">Maximum Out-of-Pocket</th></tr>' +
		          '<tr><th scope="row" class="estimatedAnnualRx columnTitle">Estimated Annual Rx</th></tr>' +
		           '<tr><th scope="row" class="annualHraHsa columnTitle">Annual HRA/HSA</th></tr>' +
		          '<tr><th scope="row" class="totalHealthRxMinusHra columnTitle">Total Health & Rx minus HRA/HSA</th></tr>' +
		          '<tr><th scope="row" class="biWklyDeduction columnTitle">Bi-Wkly Payroll Deduction</th></tr>' +
		          '<tr><th scope="row" class="annualPayrollDeduction columnTitle">Annual Payroll Deduction</th></tr>' +
		          '<tr><th scope="row" class="totalAnnualCost columnTitle">Total Annual Cost to Member</th></tr>'
		        )
		      }
		      columnTitles()
		
		      let buildTable = function (buildPlans) {
		        for (let i = 0; i < buildPlans.length; i++) {
		          let planDetails = buildPlans[i]
		          console.log(parseInt(planDetails.BiWklyPayrollDeduction))
		          if (planDetails.TierType.replace(/[^A-Z0-9]/ig, '') == tier) {
		            let annualRx
		            if (planDetails.EstimatedAnnualRx == 'Integrated') {
		              annualRx = '<td class="text-center normalCell align-middle">' + planDetails.EstimatedAnnualRx + '</td><td class="nostyle"></td>'
		            } else {
		              annualRx = '<td class="text-center normalCell align-middle">$' + planDetails.EstimatedAnnualRx + '.00</td><td class="nostyle"></td>'
		            }
		            $('.annualDeductible').parent().append('<td class="text-center normalCell align-middle cellTop">$' + parseFloat(planDetails.AnnualDeductible).toFixed(2).commafy() + '</td><td class="nostyle"></td>')
		            $('.maxOutOfPocket').parent().append('<td class="text-center normalCell align-middle">$' + parseFloat(planDetails.MaximumOutOfPocket).toFixed(2).commafy() + '</td><td class="nostyle"></td>')
		            $('.estimatedAnnualRx').parent().append(annualRx)
		            $('.annualHraHsa').parent().append('<td class="text-center normalCell align-middle">$' + parseFloat(planDetails.AnnualHraHsa).toFixed(2).commafy() + '</td><td class="nostyle"></td>')
		            $('.totalHealthRxMinusHra').parent().append('<td class="text-center normalCell align-middle">$' + parseFloat(planDetails.TotalHealthRxMinusHra).toFixed(2).commafy() + '</td><td class="nostyle"></td>')
		            $('.biWklyDeduction').parent().append('<td class="text-center subtotal align-middle">$' + parseFloat(planDetails.BiWklyPayrollDeduction).toFixed(2).commafy() + '</td><td class="nostyle"></td>')
		            $('.annualPayrollDeduction').parent().append('<td class="text-center subtotal align-middle">$' + parseFloat(planDetails.AnnualPayrollDeduction).toFixed(2).commafy() + '</td><td class="nostyle"></td>')
		            $('.totalAnnualCost').parent().append('<td class="text-center total align-middle">$' + parseFloat(planDetails.TotalAnnualCost).toFixed(2).commafy() + '</td><td class="nostyle"></td>')
		          }
		        }
		      }
		      buildTable(planItems)
		
		      let removeActive = function () {
		        $('.card').addClass('z-depth-0 border')
		        $('.card-body').removeClass('active-card')
		        $('.tier, .cost').removeClass('active')
		        $('.icon').removeClass('text-white')
		      }
		
		      let addActive = function (nowActive) {
		        nowActive.removeClass('z-depth-0 border')
		        nowActive.find('.card-body').addClass('active-card')
		        nowActive.find('.tier, .cost').addClass('active')
		        nowActive.find('.icon').addClass('text-white')
		      }
		
		      $('.card').on('click', function () {
	      		tier = this.id
		        let nowActive = $(this)
		        removeActive()
		        addActive(nowActive)

		      	effectOut()
		      	setTimeout(function(){
					var elmnt = document.getElementById("intoView");
					elmnt.scrollIntoView({behavior: "smooth"});
								        
			        columnTitles()
			        buildTable(planItems)
			        effectIn()
			      }, 500)
		      })
		
		      let comparisons = []
		      let inputEvent = function(){
			      $('input').on('change', function () {
			      	$('#frameModalBottom').modal({focus:false})
			      	let compareValue = $(this).val()
			        //console.log('I was clicked = ' + compareValue)
			        let compareChoice = '<div class="btn white text-dark compareChoice" comparevalue="' + compareValue + '">' + compareValue + '</div>'
			        console.log(comparisons.length)
			        if (comparisons.length <= 3) {
			          if ($('div[comparevalue="' + compareValue + '"]').length) {
			            $('div[comparevalue="' + compareValue + '"]').remove()
			            let index = comparisons.indexOf(compareValue)
			            if (index !== -1) {comparisons.splice(index, 1)}
			            console.log('After='+ comparisons.length)
			          } else {
			            $('.comparisons').append(compareChoice)
			            comparisons.push(compareValue)
			          }
			          //console.log(comparisons)
			        } else {
			        //console.log(comparisons)
			        this.checked = false;
			        $('div[comparevalue="' + compareValue + '"]').remove()
			        let index = comparisons.indexOf(compareValue)
			        if (index !== -1) {comparisons.splice(index, 1)}
			        }
			      })
				}
				inputEvent()
		      $('.compare').on('click', function () {
		        let comparisonArray = []
		        
		        $.each(comparisons, function (ind, compareItem) {
		          let compareplans = planItems.filter(function (item) {
		            return item.Plan === compareItem
		          })
		          comparisonArray.push(compareplans)
		        })
		
				effectOut()
				setTimeout(function(){
			        planItems = comparisonArray.flat()
			        sortPlans()
			        $('.plans').empty()
			        buildPlans()
			        columnTitles()
			        buildTable(planItems)
			        effectIn()
			        $('.compareInput').remove()
			        $('.compare').hide()
			        $('.reset').show().removeClass('d-none')
			        
			        var elmnt = document.getElementById("intoView");
					elmnt.scrollIntoView({behavior: "smooth"});
				}, 500)
		      })
		
		      $('.reset').on('click', function () {
		      	effectOut()
		      	setTimeout(function(){
			      	$('#frameModalBottom').modal('hide')
			      	comparisons = []
			      	$('.compare').show()
			        $('.reset').hide()
			      	tier = "Employee"
			      	nowActive = $('#'+ tier +'')
			      	removeActive()
			        addActive(nowActive)
			        clearTable()
			        setDefault()
			        sortPlans()
			        buildPlans()
			        columnTitles()
			        buildTable(planItems)
			        effectIn()
			        inputEvent()
		        }, 500)
		      })
		    }
		  })
		})
			$('#fullPageContent > div > div.row.pt-3.mb-r').removeClass('mb-r');
			webpartMove = $("#webpartToMove")
			webpartMove.detach();
			webpartMove.appendTo("#fullPageContent");

 
	    </script>
	</body>
</html>
