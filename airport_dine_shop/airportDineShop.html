<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<style>
	#filterOptions select{
		border:none;
		border-radius:4px;
		box-shadow: 0 2px 2px 0 rgba(0,0,0,.16), 0 2px 5px 0 rgba(0,0,0,.12);
		font-family:Arquette;
		padding:12px;	
	}
#resultBtns .btn{
    padding: .85rem 2rem;
}
h5#shopModalTitle{
	color:white!important;
	margin:0
}
</style>
</head>
<body>
<div aria-label="Airport Main Content" id="airportContent">
		<div class="container">
			<div class="row" id="filterOptions">
			    <div class="col-12 col-md-4">
			        <div class="d-md-block typeOption my-2">
			            <select class="browser-default col-12 my-0 mdb-select termSelect">
			                <option value="">Choose Location</option>
			                <option value="1">Terminal 1</option>
			                <option value="2">Terminal 2</option>
			                <option value="3">Terminal 3</option>
			                <option value="4">Terminal 4</option>
			                <option value="R">Rental Car Center</option>
			            </select>
			        </div>
			    </div>
			    <div class="col-12 col-md-8">
			    <div class="row">
			        <div class="col-12 col-md-6 d-md-block typeOption">
			            <select class="browser-default col-12 my-2 mdb-select secSelect">
			                <option value="">Choose Pre/Post-Security</option>
			                <option>Post-Security</option>
			                <option>Pre-Security</option>
			            </select>
			        </div>
			        <div class="col-12 col-md-6">
			        <button type="button" class="btn btn-info float-right float-md-none srchBtn my-2">Search</button>
			        </div>
			        </div>
			    </div>
			</div>
			<div id="moreOptions" class="my-4">
				<div id="resultTitle" class="text-center text-md-left"></div>
				<div id="resultBtns" class="btn-group d-none justify-content-center justify-content-md-start" role="group" aria-label="search results">
					<button type="button" class="btn btn-info Dine px-">Dine</button>
					<button type="button" class="btn btn-info mx-2 Shop">Shop</button>
					<button type="button" class="btn btn-info Service">Services</button>
				</div>
			</div>
			<div id="termSearchResults" class="mb-5">
			</div>
		</div>
		<div class="modal fade" id="shopInfo" tabindex="-1" role="dialog" aria-labelledby="shopModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-notify modal-info" role="document">
			<div class="modal-content">
				<div class="modal-header" style="background-color:#1C2A48">
					<h5 class="modal-title text-white text-uppercase" id="shopModalTitle">
						<!--Inject Publication Title-->
					</h5>
					<button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p id="shopModalBody" style="color:#333;">
					<!-- inject description -->	
					</p>
				</div>
				<div class="modal-footer">
				<button type="button" class="btn" style="background-color:#FF9802" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
</div>	

<script type="text/javascript" src="/Style%20Library/V6/js/vendor/mdb/jquery-3.2.1.min.js"></script>
<script type="text/javascript">

let terminalAll = []
let selectResults = []
let selectResults1 = []
let searchTermStorage = []
let searchSecStorage = []

$(document).ready(function () {
  $.ajax({
    url: "/airport/_api/web/lists/GetByTitle('terminals')/items?$top=500",
    method: 'GET',
    headers: {
      Accept: 'application/json; odata=verbose'
    },

    success: function (data) {
      let thisTerminalResults = data.d.results
      console.log(thisTerminalResults)
      let searchOption = 'Food'
      let searchTerm = ''
      // let searchAir = '';
      let searchSecurity = ''

      function filterItems(query) {
        return terminalItems.filter(function (el) {
          return el.toLowerCase().indexOf(query.toLowerCase()) > -1
        })
      }

      let clearFields = function () {
        $('#resultBtns')
          .removeClass('d-none')
          .addClass('d-flex')
        searchTerm = ''
        // searchAir = '';
        searchSecurity = ''
        $('select').each(function () {
          this.selectedIndex = 0
        })
      }

      let removeDivs = function () {
        $('#finalFilterResults').remove()
        $('#resultTitle').remove()
      }

      let buildResults = function () {
        if (searchSecurity.length && searchTerm.length) {
          if (searchTerm !== 'R') {
            resultTitle = 'Terminal ' + searchTerm + ' & ' + searchSecurity
          } else {
            resultTitle = 'Rental Car Center & ' + searchSecurity
          }
        } else if (!searchSecurity.length && searchTerm.length) {
          if (searchTerm !== 'R') {
            resultTitle = 'Terminal ' + searchTerm
          } else {
            resultTitle = 'Rental Car Center'
          }
        } else if (searchSecurity.length && !searchTerm.length) {
          resultTitle = searchSecurity
        }

        $('#termSearchResults').append(
          $('<div class="row" id="finalFilterResults"></div>')
        )
        $('#moreOptions').prepend(
          $(
            '<div id="resultTitle" class="text-center text-md-left"><h3 class="fw-500"><strong>Results for:</strong></h3> <h4>' +
            resultTitle +
            '</h4></div>'
          )
        )

        // Sets active style to Food, Shop & Service navigation buttons
        if (searchOption == 'Food') {
          $('.Dine').addClass('active')
        } else if (searchOption == 'Shop') {
          $('.Shop').addClass('active')
        } else {
          $('.Service').addClass('active')
        }

        if (selectResults1.length > 0) {
          $.each(selectResults1, function (index, resultItems) {
            $('#finalFilterResults').append(
              $(
                '<div class="col-12 col-md-6"><a class="row mx-1 my-2 py-3 z-depth-1 shopName" type="button" data-toggle="modal" data-target="#shopInfo" data-index="' +
                index +
                '"><div class="col-7 my-auto"><p class="fw-500 my-auto">' +
                resultItems.Title +
                '</p></div><div class="col-5 d-flex justify-content-end"><p class="my-auto pr-3">Terminal ' +
              resultItems.terminal.charAt(0) +
              ' Concourse ' +
              resultItems.terminal.substr(1) +
                '</p><i class="fal fa-plus-circle fa-2x broward-color-blue my-auto"></i></div></a></div>'
              )
            )
          })
        } else {
          $('#finalFilterResults').append(
            $(
              '<div class="col-12 pt-3 text-center text-md-left"><h3>Sorry! No matching results.</h3><h5>Adjust your filter options and try again.</h5></div>'
            )
          )
        }
        $('body').on('click', '.shopName', function () {
          let index = $(this).attr('data-index')
          let terminalItems = selectResults1[index]
          $('#shopModalTitle').html(terminalItems.Title)
          if (terminalItems.terminal.length <= 3) {
            $('#shopModalBody').html(
              '<div class="fw-400 my-auto"><i class="fal fa-map-marker-alt mr-1" style="font-size:1.5rem;"></i> Terminal ' +
              terminalItems.terminal.charAt(0) +
              ' Concourse ' +
              terminalItems.terminal.substr(1) +
              '</div><div class="fw-400 pt-1"><i class="fal fa-shield-check" style="font-size:1.5rem;"></i> ' +
              terminalItems.security +
              '</div><div class="fw-400 pt-1"><i class="fal fa-clock" style="font-size:1.5rem;"></i> Hours: ' +
              terminalItems.hours +
              '</div><div class="pt-3">' +
              terminalItems.description +
              '</div>'
            )
          } else if (
            terminalItems.terminal.length > 3 &&
            terminalItems.terminal != 'Rental Car Center'
          ) {
            $('#shopModalBody').html(
              '<div class="fw-400 my-auto"><i class="fal fa-map-marker-alt mr-1" style="font-size:1.5rem;"></i> Terminal ' +
              terminalItems.terminal +
              '</div><div class="fw-400 pt-1"><i class="fal fa-shield-check" style="font-size:1.5rem;"></i> ' +
              terminalItems.security +
              '</div><div class="fw-400 pt-1"><i class="fal fa-clock" style="font-size:1.5rem;"></i> Hours: ' +
              terminalItems.hours +
              '</div><div class="pt-3">' +
              terminalItems.description +
              '</div>'
            )
          } else {
            $('#shopModalBody').html(
              '<div class="fw-400 my-auto"><i class="fal fa-map-marker-alt mr-1" style="font-size:1.5rem;"></i> ' +
              terminalItems.terminal +
              '</div><div class="fw-400 pt-1"><i class="fal fa-shield-check" style="font-size:1.5rem;"></i> ' +
              terminalItems.security +
              '</div><div class="fw-400 pt-1"><i class="fal fa-clock" style="font-size:1.5rem;"></i> Hours: ' +
              terminalItems.hours +
              '</div><div class="pt-3">' +
              terminalItems.description +
              '</div>'
            )
          }
        })
      }

      for (let i = 0; i < thisTerminalResults.length; i++) {
        terminalAll.push(thisTerminalResults[i])
      }

      for (let i = 0; i < terminalAll.length; i++) {
        terminalItems = terminalAll[i]
      }

      $('.termSelect').on('change', function () {
        searchTermStorage = []
        // get terminal for filter
        searchTerm = $(this).val()
        searchTermStorage.push(searchTerm)
      })
      /* $('.airSelect').on('change', function () {
              //get security option
              searchAir = $(this).val();
              console.log(searchSecurity);
          }); */

      $('.secSelect').on('change', function () {
        searchSecStorage = []
        // get security option
        searchSecurity = $(this).val()
        searchSecStorage.push(searchSecurity)
      })

      let searchFor = function () {
        // clear previous results
        selectResults = []
        // filter by foodOrShop
        let filterStoreType = terminalAll.filter(function (item) {
          return item.foodOrShop == searchOption
        })
        selectResults.push(filterStoreType)

        if (searchTerm.length && searchSecurity.length <= 0) {
          // filter by Terminal
          let filterTerm = selectResults[0].filter(function (item) {
            return item.terminal.charAt(0) === searchTerm && item.closed === false 
          })
          selectResults.push(filterTerm)

          selectResults1 = selectResults[1]
          buildResults()
          clearFields()
        } else if (searchTerm.length && searchSecurity.length) {
          // filter by Terminal
          let filterTerm = selectResults[0].filter(function (item) {
            return item.terminal.charAt(0) === searchTerm  && item.closed === false 
          })
          selectResults.push(filterTerm)

          // filter by Security
          let filterSecurity = selectResults[1].filter(function (item) {
            return item.security === searchSecurity
          })
          selectResults.push(filterSecurity)

          selectResults1 = selectResults[2]
          buildResults()
          clearFields()
        } else if (searchTerm.length <= 0 && searchSecurity.length) {
          // filter by Security
          let filterSecurity = selectResults[0].filter(function (item) {
            return item.security === searchSecurity
          })
          selectResults.push(filterSecurity)

          selectResults1 = selectResults[1]
          buildResults()
          clearFields()
        } else {

        }
      }

      $('.srchBtn').on('click', function () {
        if (!searchTerm.length) {
          searchTermStorage = []
        }
        if (!searchSecurity.length) {
          searchSecStorage = []
        }
        $('#resultBtns')
          .find('.active')
          .removeClass('active')
        searchOption = 'Food'
        removeDivs()
        searchFor()
      })
      $('.Shop').on('click', function () {
        $('#resultBtns')
          .find('.active')
          .removeClass('active')
        searchOption = 'Shop'
        searchTerm = searchTermStorage['0'] ? searchTermStorage['0'] : ''
        searchSecurity = searchSecStorage['0'] ? searchSecStorage['0'] : ''
        removeDivs()
        searchFor()
      })
      $('.Dine').on('click', function () {
        $('#resultBtns')
          .find('.active')
          .removeClass('active')
        searchOption = 'Food'
        searchTerm = searchTermStorage['0'] ? searchTermStorage['0'] : ''
        searchSecurity = searchSecStorage['0'] ? searchSecStorage['0'] : ''
        removeDivs()
        searchFor()
      })
      $('.Service').on('click', function () {
        $('#resultBtns')
          .find('.active')
          .removeClass('active')
        searchOption = 'Service'
        searchTerm = searchTermStorage['0'] ? searchTermStorage['0'] : ''
        searchSecurity = searchSecStorage['0'] ? searchSecStorage['0'] : ''
        removeDivs()
        searchFor()
      })
    }
  })
})
/*$('#fullPageContent > div > div.row.pt-3.mb-r').removeClass('mb-r')
webpartMove = $('#airportContent')
webpartMove.detach()
webpartMove.appendTo('#fullPageContent')*/

	    </script>
	</body>
</html>